{% extends "admin/change_list.html" %} 

{% block content %} 
    {{ block.super }}
    <style>
        .toggle_status {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
        }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function () {
        const tableImg = document.getElementsByTagName("img");
        const lenTableImg = tableImg.length;
        const tableStatus = document.getElementsByClassName("field-status");
        const tableId = document.getElementsByClassName("field-id");

        for (let i = 0; i < lenTableImg; i++) {
            const newLink = document.createElement("a");
            newLink.className = "toggle_status";
            newLink.appendChild(tableImg[i]);
            tableStatus[i].appendChild(newLink);
        }

        const tableStatusToggle = document.getElementsByClassName("toggle_status");
        for (let i = 0; i < lenTableImg; i++) {
            tableStatusToggle[i].addEventListener("click", function() {
                const current_status = tableImg[i].alt;
                const account_id = tableId[i].querySelector("a").textContent;
                $.ajax({
                    type: "GET",
                    url: '{% url 'acc_change_list_view' %}',  
                    data: {
                        current_status : current_status,
                        account_id : account_id
                        
                    },
                    success: function(response) {
                        const new_status = response.new_status;
                        tableImg[i].alt = new_status;
                        console.log("change success");
                    }
                });
            });
        }
    });
    </script>
{% endblock %}
